<!-- Page Title/Header -->
<h1 class="page-header">User Profile</h1>

<!-- Loading Spinner -->
<div *ngIf="loading" class="loading-spinner">
  <mat-spinner diameter="50"></mat-spinner>
</div>

<!-- Main Content Container -->
<div *ngIf="!loading" class="user-profile-container">
  <!-- Left Column: User Info + Update Profile -->
  <div class="left-section">
    <!-- User Info -->
    <div class="user-profile">
      <h2>User Info</h2>
      <p><strong>Username:</strong> {{ userData.username || "No Username" }}</p>
      <p><strong>Email:</strong> {{ userData.email || "No Email" }}</p>
      <p>
        <strong>Birthdate:</strong>
        {{ userData.birthdate | date: "longDate" || "No Birthdate" }}
      </p>
    </div>

    <!-- Update Profile Form -->
    <div class="update-profile-container">
      <h2>Update Profile</h2>
      <form (submit)="updateUser()" #updateProfileForm="ngForm">
        <input
          type="text"
          name="username"
          [(ngModel)]="updatedUsername"
          placeholder="New Username"
          required
        />
        <input
          type="email"
          name="email"
          [(ngModel)]="updatedEmail"
          placeholder="New Email"
          required
        />
        <mat-form-field appearance="fill" class="birthdate-field">
          <mat-label>Birthdate</mat-label>
          <input
            matInput
            [matDatepicker]="picker"
            [(ngModel)]="updatedBirthdate"
            name="birthdate"
            class="birthdate-input"
            placeholder="MM/DD/YYYY"
            required
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="picker"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
        <button type="submit" [disabled]="updateProfileForm.invalid || loading">
          Update Profile
        </button>
      </form>
    </div>
  </div>

  <!-- Right Column: Favorite Movies -->
  <div class="right-section">
    <h2>Favorite Movies</h2>
    <div *ngIf="!loading && !error">
      <div class="movie-cards-container">
        <mat-card *ngFor="let movie of favoriteMovies" class="movie-card">
          <!-- Header -->
          <mat-card-header class="movie-card-header">
            <mat-card-title class="movie-title">{{
              movie.title
            }}</mat-card-title>
          </mat-card-header>

          <!-- Image (Hidden if any details are open) -->
          <div
            class="movie-image-container"
            *ngIf="
              !movie.showGenreDetails &&
              !movie.showDirectorDetails &&
              !movie.showSynopsis
            "
          >
            <img
              mat-card-image
              [src]="movie.imagePath"
              [alt]="movie.title"
              (error)="onImageError($event)"
              class="movie-image"
            />
          </div>

          <!-- Movie Details -->
          <div class="movie-card-details">
            <!-- Synopsis -->
            <div *ngIf="movie.showSynopsis" class="synopsis">
              <span>{{ movie.synopsis }}</span>
            </div>

            <!-- Genre Details -->
            <div *ngIf="movie.showGenreDetails" class="genre-details">
              <span class="genre-text">
                <strong>Genre:</strong> {{ movie.genre.name }}
              </span>
              <div class="genre-description">
                <span class="description-text">
                  <strong>Description:</strong> {{ movie.genre.description }}
                </span>
              </div>
            </div>

            <!-- Director Details -->
            <div *ngIf="movie.showDirectorDetails" class="director-name">
              <span><strong>Name:</strong> {{ movie.director.name }}</span>
              <div class="director-bio">
                <span><strong>Bio:</strong> {{ movie.director.bio }}</span>
              </div>
              <div *ngIf="movie.director.birthYear" class="director-birth-year">
                <span
                  ><strong>Birth Year:</strong>
                  {{ movie.director.birthYear }}</span
                >
                <div *ngIf="isValidDeathYear(movie.director.deathYear)" class="director-death-year">
                    <span><strong>Death Year:</strong> {{ movie.director.deathYear }}</span>
                  </div>
                  
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
              <mat-icon
                class="favorite-icon"
                (click)="toggleFavorite(movie)"
                [ngClass]="{ 'favorite-selected': movie.isFavorite }"
                >{{
                  movie.isFavorite ? "favorite" : "favorite_border"
                }}</mat-icon
              >

              <button
                (click)="
                  movie.showSynopsis = !movie.showSynopsis;
                  movie.showGenreDetails = false;
                  movie.showDirectorDetails = false
                "
              >
                Synopsis
              </button>
              <button
                (click)="
                  movie.showGenreDetails = !movie.showGenreDetails;
                  movie.showSynopsis = false;
                  movie.showDirectorDetails = false
                "
              >
                Genre
              </button>
              <button
                (click)="
                  movie.showDirectorDetails = !movie.showDirectorDetails;
                  movie.showSynopsis = false;
                  movie.showGenreDetails = false
                "
              >
                Director
              </button>
            </div>
          </div>
        </mat-card>
      </div>
    </div>
  </div>
</div>
