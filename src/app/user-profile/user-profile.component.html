<!-- Page Title/Header -->
<h1 class="page-header">
  User <span class="capitalize-second-word">Profile</span>
</h1>

<!-- Loading Spinner: Displays a loading spinner while content is being loaded -->
<div *ngIf="loading" class="loading-spinner">
  <mat-spinner diameter="50"></mat-spinner>
</div>

<!-- User Profile and Update Profile Sections: Only visible once the content has loaded -->
<div *ngIf="!loading" class="user-profile-container">
  <!-- User Profile Section: Displays user information like username, email, and birthdate -->
  <div class="user-profile">
    <h2>User Info</h2>
    <!-- Displaying username, email, and birthdate. If data is missing, show a fallback message -->
    <p><strong>Username:</strong> {{ userData.username || "No Username" }}</p>
    <p><strong>Email:</strong> {{ userData.email || "No Email" }}</p>
    <p>
      <strong>Birthdate:</strong>
      {{ userData.birthdate | date : "longDate" || "No Birthdate" }}
    </p>
  </div>

  <!-- Update Profile Section: Allows users to update their profile details (username, email, birthdate) -->
  <div class="update-profile-container">
    <h2>Update Profile</h2>
    <!-- Form for updating user information, uses Angular's ngForm for validation -->
    <form (submit)="updateUser()" #updateProfileForm="ngForm">
      <input type="text" name="username" placeholder="New Username" required />
      <input type="email" name="email" placeholder="New Email" required />

      <!-- Birthdate input using Angular Material's date picker -->
      <mat-form-field appearance="fill" class="birthdate-field">
        <mat-label>Birthdate</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          name="birthdate"
          class="birthdate-input"
          placeholder="MM/DD/YYYY"
          required
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <!-- Submit button, disabled if form is invalid or loading -->
      <button type="submit" [disabled]="updateProfileForm.invalid || loading">
        Update Profile
      </button>
    </form>
  </div>
</div>

<!-- Favorite Movies Section: Displays a list of favorite movies -->
<mat-card>
  <div class="favorite-movies-container">
    <h2>Favorite Movies</h2>
    <!-- Conditional rendering: Only display content if not loading and no errors are present -->
    <div *ngIf="!loading && !error">
      <!-- Container for all movie cards -->
      <div class="movie-cards-container">
        <!-- Iterates through the favoriteMovies array and displays each movie in a card -->
        <div *ngFor="let movie of favoriteMovies" class="movie-card">
          <!-- Movie card header section -->
          <mat-card-header class="movie-card-header">
            <!-- Display the movie title -->
            <mat-card-title class="movie-title">{{
              movie.title
            }}</mat-card-title>
          </mat-card-header>

          <!-- Image section of the movie card -->
          <div class="movie-image-container">
            <!-- Movie poster image -->
            <img
              mat-card-image
              [src]="movie.imagePath"
              [alt]="movie.title"
              (error)="onImageError($event)"
              class="movie-image"
            />
          </div>

          <!-- Content section of movie card -->
          <mat-card-content>
            <div class="movie-card-details">
              <!-- Container for interactive buttons -->
              <div class="buttons-container">
                <!-- Add to Favorites Button -->
                <div class="favorite-container" (click)="toggleFavorite(movie)">
                  <!-- Favorite icon changes based on the movie's favorite status -->
                  <mat-icon [ngClass]="{ favorite: movie.isFavorite }">
                    {{ movie.isFavorite ? "favorite" : "favorite_border" }}
                  </mat-icon>

                  <!-- Text updates dynamically based on the favorite status -->
                  <div class="text-container">
                    <span>Remove from Favorites</span>
                  </div>
                </div>

                <!-- Show/Hide Details Button -->
                <div class="button-container" (click)="toggleAllDetails(movie)">
                  <!-- Expand/collapse icon toggles based on details visibility -->
                  <mat-icon>{{
                    movie.areDetailsVisible ? "expand_less" : "expand_more"
                  }}</mat-icon>
                  <!-- Button text changes based on details visibility -->
                  <div class="text-container">
                    <span>{{
                      movie.areDetailsVisible ? "Hide Details" : "Show Details"
                    }}</span>
                  </div>
                </div>
              </div>

              <!-- Details section: Displays additional movie information if details are visible -->
              <div *ngIf="movie.areDetailsVisible" class="movie-details">
                <p><strong>Synopsis:</strong>{{ movie.synopsis }}</p>
                <div>
                  <p><strong>Genre:</strong> {{ movie.genre.name }}</p>
                  <p>
                    <strong>Description:</strong>
                    {{ movie.genre.description || "No description available." }}
                  </p>
                </div>
                <div>
                  <p><strong>Director:</strong> {{ movie.director.name }}</p>
                  <p><strong>Bio:</strong> {{ movie.director.bio }}</p>
                  <p>
                    <strong>Birth Year:</strong>
                    {{ movie.director.birthYear || "N/A" }}
                  </p>
                  <p>
                    <strong>Death Year:</strong>
                    {{ movie.director.deathYear || "N/A" }}
                  </p>
                </div>
              </div>
            </div>
          </mat-card-content>
        </div>
      </div>
    </div>
  </div>
</mat-card>
